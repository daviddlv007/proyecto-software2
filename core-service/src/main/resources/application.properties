# ============================================
# CORE SERVICE - Application Properties
# Compatible con H2 (desarrollo) y PostgreSQL (Docker/Producci√≥n)
# ============================================

# Puerto del servidor
server.port=${SERVER_PORT:8080}

# ============================================
# DATASOURCE - Configurable via ENV
# ============================================
spring.datasource.url=${SPRING_DATASOURCE_URL:jdbc:h2:mem:testdb}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME:sa}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD:}
spring.datasource.driver-class-name=${SPRING_DATASOURCE_DRIVER:org.h2.Driver}

# Connection pool (optimizado para recursos limitados)
spring.datasource.hikari.maximum-pool-size=${DB_POOL_SIZE:5}
spring.datasource.hikari.minimum-idle=${DB_POOL_MIN_IDLE:2}
spring.datasource.hikari.connection-timeout=20000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=1200000

# ============================================
# JPA / HIBERNATE
# ============================================
spring.jpa.hibernate.ddl-auto=${SPRING_JPA_HIBERNATE_DDL_AUTO:update}
spring.jpa.show-sql=${SPRING_JPA_SHOW_SQL:false}
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.dialect=${HIBERNATE_DIALECT:org.hibernate.dialect.H2Dialect}

# Performance optimizations
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.open-in-view=false

# ============================================
# GRAPHQL
# ============================================
spring.graphql.graphiql.enabled=${GRAPHIQL_ENABLED:true}
spring.graphql.path=/graphql
spring.graphql.graphiql.path=/graphiql

# ============================================
# H2 CONSOLE (solo para desarrollo local)
# ============================================
spring.h2.console.enabled=${H2_CONSOLE_ENABLED:true}
spring.h2.console.path=/h2-console

# ============================================
# ACTUATOR (Health checks para Docker)
# ============================================
management.endpoints.web.exposure.include=health,info
management.endpoint.health.show-details=when-authorized
management.health.livenessstate.enabled=true
management.health.readinessstate.enabled=true

# ============================================
# LOGGING
# ============================================
logging.level.root=INFO
logging.level.com.supermercado=DEBUG
logging.level.org.springframework.graphql=DEBUG
logging.level.org.hibernate.SQL=${SQL_LOG_LEVEL:WARN}
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - [%level] %logger{36} - %msg%n


# ============================================
# STRIPE PAYMENTS
# ============================================
stripe.secret.key=${STRIPE_SECRET_KEY:sk_test_51ROVXK4IgZQzA85xO3sJaFjNr6YLPz2dCR8yXBB3Gf1KDlKXq9kzLGF6CZnr2Uu5eC8gZ3lE0wW4rQ7yT2}
stripe.webhook.secret=${STRIPE_WEBHOOK_SECRET:}

# Payments URLs
app.success.url=${APP_SUCCESS_URL:http://localhost:8080/api/payments/success}
app.cancel.url=${APP_CANCEL_URL:http://localhost:8080/api/payments/cancel}
currency=${CURRENCY:USD}


management.endpoints.web.exposure.include=health,info,configprops

# ============================================
# JWT
# ============================================
jwt.secret=${JWT_SECRET:change-this-super-secret-key-in-production-minimum-256-bits}
jwt.expiration=${JWT_EXPIRATION:86400000}

# ============================================
# DELIVERY
# ============================================
delivery.origin-lat=${DELIVERY_ORIGIN_LAT:-17.7833}
delivery.origin-lng=${DELIVERY_ORIGIN_LNG:-63.1821}
delivery.base-fee=${DELIVERY_BASE_FEE:2.0}
delivery.per-km=${DELIVERY_PER_KM:0.5}
delivery.mode=${DELIVERY_MODE:driving}